<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∏ªÊí≠ÁÆ°ÁêÜÂêéÂè∞</title>
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <!-- Naive UI -->
    <script src="https://unpkg.com/naive-ui@2.39.0/dist/index.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/vfonts/Lato.css">
    <link rel="stylesheet" href="https://unpkg.com/vfonts/FiraCode.css">
    <style>
        body {
            margin: 0;
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
        }

        .back-to-index {
            margin-top: 0;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1rem;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: white;
        }

        .menu-item.active {
            background: rgba(255, 255, 255, 0.2);
            border-left-color: white;
            font-weight: bold;
        }

        .menu-icon {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        .main-content {
            flex: 1;
            margin-left: 280px;
            padding: 30px;
            overflow-y: auto;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .admin-actions {
            display: flex;
            gap: 12px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .profile-form {
            max-width: 600px;
        }

        .upload-area {
            border: 2px dashed #d9d9d9;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 16px;
        }

        .upload-area:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .upload-area.dragover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 20px;
            color: #667eea;
        }

        @media (max-width: 1200px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }
            
            .sidebar.open {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                padding: 20px;
            }
            
            .mobile-menu-toggle {
                display: block !important;
            }
        }

        .mobile-menu-toggle {
            display: none;
        }

        .message-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 6px;
            color: white;
            font-size: 14px;
            z-index: 10000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .message-toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .message-success { background-color: #18a058; }
        .message-error { background-color: #d03050; }
        .message-warning { background-color: #f0a020; }
        .message-info { background-color: #2080f0; }

        .song-item {
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 10px;
            background: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .song-info {
            flex: 1;
        }

        .song-actions {
            display: flex;
            gap: 8px;
        }

        .tag-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid #e0e0e0;
        }

        .tag-stats {
            font-size: 0.9rem;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="app">
        <n-config-provider :theme="theme" :theme-overrides="themeOverrides">
            <n-message-provider>
                <admin-content />
            </n-message-provider>
        </n-config-provider>
    </div>

    <script>
        if (typeof Vue === 'undefined') {
            console.error('Vue.js Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•');
            document.body.innerHTML = '<div style="text-align:center;padding:50px;font-size:18px;">Vue.js Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï</div>';
        } else {
            const { createApp } = Vue;
            const { 
                NConfigProvider, 
                NCard,
                NButton,
                NIcon,
                NText,
                NSpace,
                NStatistic,
                NList,
                NListItem,
                NThing,
                NTag,
                NEmpty,
                NForm,
                NFormItem,
                NInput,
                NSelect,
                NGrid,
                NGridItem,
                NModal,
                NMessageProvider,
                useMessage
            } = naive;

            const AdminContent = {
                template: `
                    <div class="admin-container">
                        <!-- ‰æßËæπÊ†è -->
                        <div class="sidebar" :class="{ open: sidebarOpen }">
                            <div class="sidebar-header">
                                <div class="back-to-index">
                                    <n-button 
                                        type="info" 
                                        size="small" 
                                        round 
                                        @click="goToIndex"
                                        style="width: 100%;"
                                    >
                                        <template #icon>
                                            <n-icon>
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                                    <path fill="currentColor" d="M20 11H7.83l5.59-5.59L12 4l-8 8l8 8l1.42-1.41L7.83 13H20v-2z"/>
                                                </svg>
                                            </n-icon>
                                        </template>
                                        ËøîÂõûÊ≠åÂçïÈ°µÈù¢
                                    </n-button>
                                </div>
                            </div>
                            <div class="sidebar-menu">
                                <div class="menu-item" :class="{ active: currentPage === 'overview' }" @click="navigateTo('overview')">
                                    <span class="menu-icon">üìä</span>
                                    <span>Êï∞ÊçÆÊ¶ÇËßà</span>
                                </div>
                                <div class="menu-item" :class="{ active: currentPage === 'profile' }" @click="navigateTo('profile')">
                                    <span class="menu-icon">üë§</span>
                                    <span>‰∏ªÊí≠ËÆæÁΩÆ</span>
                                </div>
                                <div class="menu-item" :class="{ active: currentPage === 'tags' }" @click="navigateTo('tags')">
                                    <span class="menu-icon">üè∑Ô∏è</span>
                                    <span>Ê†áÁ≠æÁÆ°ÁêÜ</span>
                                </div>
                                <div class="menu-item" :class="{ active: currentPage === 'songs' }" @click="navigateTo('songs')">
                                    <span class="menu-icon">üéµ</span>
                                    <span>Ê≠åÊõ≤ÁÆ°ÁêÜ</span>
                                </div>
                            </div>
                        </div>

                        <!-- ‰∏ªÂÜÖÂÆπÂå∫ -->
                        <div class="main-content">
                            <!-- ÁßªÂä®Á´ØËèúÂçïÊåâÈíÆ -->
                            <n-button 
                                class="mobile-menu-toggle" 
                                @click="sidebarOpen = !sidebarOpen"
                                style="margin-bottom: 20px;"
                                circle
                                size="large"
                            >
                                <template #icon>
                                    <n-icon>
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                            <path fill="currentColor" d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                                        </svg>
                                    </n-icon>
                                </template>
                            </n-button>

                            <!-- È°µÈù¢Â§¥ÈÉ® -->
                            <div class="admin-header">
                                <div>
                                    <n-text style="font-size: 1.8rem; font-weight: bold;">{{ pageTitle }}</n-text>
                                    <div style="margin-top: 5px;">
                                        <n-text depth="3">{{ pageSubtitle }}</n-text>
                                    </div>
                                </div>
                                <div class="admin-actions">
                                    <n-button type="info" @click="refreshData" :loading="loading">
                                        <template #icon>
                                            <n-icon>
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                                    <path fill="currentColor" d="M17.65 6.35A7.958 7.958 0 0 0 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08A5.99 5.99 0 0 1 12 18c-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                                                </svg>
                                            </n-icon>
                                        </template>
                                        Âà∑Êñ∞
                                    </n-button>
                                    <n-button type="error" @click="logout">
                                        <template #icon>
                                            <n-icon>
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                                    <path fill="currentColor" d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.59L17 17l5-5l-5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                                                </svg>
                                            </n-icon>
                                        </template>
                                        ÈÄÄÂá∫ÁôªÂΩï
                                    </n-button>
                                </div>
                            </div>

                            <!-- Êï∞ÊçÆÊ¶ÇËßàÈ°µÈù¢ -->
                            <div v-if="currentPage === 'overview'">
                                <div class="stats-grid">
                                    <n-card title="ÊÄªÊ≠åÊõ≤Êï∞" hoverable>
                                        <n-statistic :value="songs.length" />
                                    </n-card>
                                    <n-card title="Ê†áÁ≠æÊï∞Èáè" hoverable>
                                        <n-statistic :value="tags.length" />
                                    </n-card>
                                    <n-card title="Á≥ªÁªüÁä∂ÊÄÅ" hoverable>
                                        <n-statistic value="Ê≠£Â∏∏" />
                                    </n-card>
                                </div>

                                <n-card title="ÊúÄËøëÊ∑ªÂä†ÁöÑÊ≠åÊõ≤" hoverable>
                                    <n-list>
                                        <n-list-item v-for="song in songs.slice(-5)" :key="song.id">
                                            <n-thing :title="song.title" :description="song.artist">
                                                <template #footer>
                                                    <n-space>
                                                        <n-tag v-for="tag in song.tags" :key="tag" size="small" type="info">
                                                            {{ tag }}
                                                        </n-tag>
                                                    </n-space>
                                                </template>
                                            </n-thing>
                                        </n-list-item>
                                    </n-list>
                                    <n-empty v-if="songs.length === 0" description="ÊöÇÊó†Ê≠åÊõ≤" />
                                </n-card>
                            </div>

                            <!-- ‰∏ªÊí≠ËÆæÁΩÆÈ°µÈù¢ -->
                            <div v-if="currentPage === 'profile'">
                                <div class="form-section">
                                    <div class="section-title">Â§¥ÂÉèËÆæÁΩÆ</div>
                                    <div style="display: flex; gap: 20px; align-items: flex-start;">
                                        <!-- ÂΩìÂâçÂ§¥ÂÉèÈ¢ÑËßà -->
                                        <div v-if="profileForm.avatar" style="flex-shrink: 0;">
                                            <div style="margin-bottom: 8px; font-weight: 500; color: #666;">ÂΩìÂâçÂ§¥ÂÉè</div>
                                            <div style="border: 2px solid #e0e0e0; border-radius: 8px; padding: 10px; background: white;">
                                                <img :src="profileForm.avatar" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover;" />
                                            </div>
                                        </div>
                                        
                                        <!-- ‰∏ä‰º†Âå∫Âüü -->
                                        <div style="flex: 1;">
                                            <div style="margin-bottom: 8px; font-weight: 500; color: #666;">‰∏ä‰º†Êñ∞Â§¥ÂÉè</div>
                                            <div class="upload-area" @click="$refs.avatarInput.click()" @dragover.prevent @drop.prevent="handleAvatarDrop">
                                                <input ref="avatarInput" type="file" style="display: none" accept="image/*" @change="handleAvatarUpload">
                                                <n-icon size="40" style="color: #ccc; margin-bottom: 10px;">
                                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                                        <path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z M12,12L16,16H13V19H11V16H8L12,12Z"/>
                                                    </svg>
                                                </n-icon>
                                                <div>ÁÇπÂáªÊàñÊãñÊãΩ‰∏ä‰º†Â§¥ÂÉè</div>
                                                <div style="font-size: 12px; color: #999; margin-top: 5px;">ÊîØÊåÅ JPG„ÄÅPNG Ê†ºÂºèÔºåÂª∫ËÆÆÂ∞∫ÂØ∏ 300x300</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <div class="section-title">ËÉåÊôØÂõæËÆæÁΩÆ</div>
                                    <div style="display: flex; gap: 20px; align-items: flex-start;">
                                        <!-- ÂΩìÂâçËÉåÊôØÈ¢ÑËßà -->
                                        <div v-if="profileForm.background" style="flex-shrink: 0;">
                                            <div style="margin-bottom: 8px; font-weight: 500; color: #666;">ÂΩìÂâçËÉåÊôØ</div>
                                            <div style="border: 2px solid #e0e0e0; border-radius: 8px; padding: 10px; background: white;">
                                                <img :src="profileForm.background" style="width: 200px; height: 120px; border-radius: 6px; object-fit: cover;" />
                                            </div>
                                        </div>
                                        
                                        <!-- ‰∏ä‰º†Âå∫Âüü -->
                                        <div style="flex: 1;">
                                            <div style="margin-bottom: 8px; font-weight: 500; color: #666;">‰∏ä‰º†Êñ∞ËÉåÊôØ</div>
                                            <div class="upload-area" @click="$refs.backgroundInput.click()" @dragover.prevent @drop.prevent="handleBackgroundDrop">
                                                <input ref="backgroundInput" type="file" style="display: none" accept="image/*" @change="handleBackgroundUpload">
                                                <n-icon size="40" style="color: #ccc; margin-bottom: 10px;">
                                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                                        <path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z M12,12L16,16H13V19H11V16H8L12,12Z"/>
                                                    </svg>
                                                </n-icon>
                                                <div>ÁÇπÂáªÊàñÊãñÊãΩ‰∏ä‰º†ËÉåÊôØÂõæ</div>
                                                <div style="font-size: 12px; color: #999; margin-top: 5px;">ÊîØÊåÅ JPG„ÄÅPNG Ê†ºÂºèÔºåÂª∫ËÆÆÂ∞∫ÂØ∏ 1920x1080</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <div class="section-title">Âü∫Êú¨‰ø°ÊÅØ</div>
                                    <n-form :model="profileForm" label-placement="top">
                                        <n-form-item label="‰∏ªÊí≠ÂêçÁß∞">
                                            <n-input v-model:value="profileForm.name" placeholder="ËØ∑ËæìÂÖ•‰∏ªÊí≠ÂêçÁß∞" />
                                        </n-form-item>
                                        <n-form-item label="‰∏™‰∫∫ÁÆÄ‰ªã">
                                            <n-input 
                                                v-model:value="profileForm.description" 
                                                type="textarea" 
                                                placeholder="ËØ∑ËæìÂÖ•‰∏™‰∫∫ÁÆÄ‰ªã"
                                                :rows="4"
                                            />
                                        </n-form-item>
                                        <n-form-item>
                                            <n-button type="primary" @click="saveProfile" :loading="profileSaving">
                                                ‰øùÂ≠òËÆæÁΩÆ
                                            </n-button>
                                        </n-form-item>
                                    </n-form>
                                </div>
                            </div>

                            <!-- Ê†áÁ≠æÁÆ°ÁêÜÈ°µÈù¢ -->
                            <div v-if="currentPage === 'tags'">
                                <div class="form-section">
                                    <div class="section-title">Ê∑ªÂä†Êñ∞Ê†áÁ≠æ</div>
                                    <n-space>
                                        <n-input v-model:value="newTagName" placeholder="ËæìÂÖ•Ê†áÁ≠æÂêçÁß∞" style="width: 200px;" @keyup.enter="addTag" />
                                        <n-button type="primary" @click="addTag" :loading="tagAdding">Ê∑ªÂä†Ê†áÁ≠æ</n-button>
                                    </n-space>
                                </div>

                                <div class="form-section">
                                    <div class="section-title">Áé∞ÊúâÊ†áÁ≠æ</div>
                                    <div v-for="tag in tagDetails" :key="tag.id" class="tag-item">
                                        <div>
                                            <n-text strong>{{ tag.name }}</n-text>
                                            <div class="tag-stats">‰ΩøÁî®Ê¨°Êï∞: {{ tag.usage_count }}</div>
                                        </div>
                                        <n-space>
                                            <n-button size="small" @click="editTag(tag)">ÁºñËæë</n-button>
                                            <n-button size="small" type="error" @click="deleteTag(tag.name)">Âà†Èô§</n-button>
                                        </n-space>
                                    </div>
                                    <n-empty v-if="tagDetails.length === 0" description="ÊöÇÊó†Ê†áÁ≠æ" />
                                </div>
                            </div>

                            <!-- Ê≠åÊõ≤ÁÆ°ÁêÜÈ°µÈù¢ -->
                            <div v-if="currentPage === 'songs'">
                                <div class="form-section">
                                    <div class="section-title">ÊâπÈáèÂØºÂÖ•Ê≠åÊõ≤</div>
                                    <n-space size="large">
                                        <n-button type="info" @click="$refs.excelInput.click()" :loading="excelImporting">
                                            <template #icon>
                                                <n-icon>
                                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                                        <path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z M16,11H14V17H16V11Z M12,11H10V17H12V11Z M8,11H6V17H8V11Z"/>
                                                    </svg>
                                                </n-icon>
                                            </template>
                                            ExcelÂØºÂÖ•
                                        </n-button>
                                        <n-button type="success" @click="$refs.imageInput.click()" :loading="imageImporting">
                                            <template #icon>
                                                <n-icon>
                                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                                        <path fill="currentColor" d="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"/>
                                                    </svg>
                                                </n-icon>
                                            </template>
                                            ÂõæÁâáËØÜÂà´ÂØºÂÖ•
                                        </n-button>
                                        <input ref="excelInput" type="file" style="display: none" accept=".xlsx,.xls" @change="handleExcelImport">
                                        <input ref="imageInput" type="file" style="display: none" accept="image/*" @change="handleImageImport">
                                    </n-space>
                                    <div style="margin-top: 12px; font-size: 14px; color: #666;">
                                        <p style="margin: 5px 0;">ExcelÂØºÂÖ•ÔºöÊîØÊåÅ .xlsx/.xls Ê†ºÂºèÔºåË°®Â§¥Â∫îÂåÖÂê´ÔºöÊ≠åÊõ≤ÂêçÁß∞„ÄÅÊ≠åÊâã„ÄÅÊ†áÁ≠æÔºàÁî®ÈÄóÂè∑ÂàÜÈöîÔºâ</p>
                                        <p style="margin: 5px 0;">ÂõæÁâáËØÜÂà´ÔºöÊîØÊåÅÊ≠åÂçïÊà™ÂõæÁöÑOCRËØÜÂà´ÔºåËá™Âä®ÊèêÂèñÊ≠åÊõ≤‰ø°ÊÅØ</p>
                                    </div>
                                </div>

                                <div class="form-section">
                                    <div class="section-title">Ê∑ªÂä†Êñ∞Ê≠åÊõ≤</div>
                                    <n-form :model="songForm" label-placement="top">
                                        <n-grid :cols="2" :x-gap="20">
                                            <n-grid-item>
                                                <n-form-item label="Ê≠åÊõ≤ÂêçÁß∞">
                                                    <n-input v-model:value="songForm.title" placeholder="ËØ∑ËæìÂÖ•Ê≠åÊõ≤ÂêçÁß∞" />
                                                </n-form-item>
                                            </n-grid-item>
                                            <n-grid-item>
                                                <n-form-item label="Ê≠åÊâã">
                                                    <n-input v-model:value="songForm.artist" placeholder="ËØ∑ËæìÂÖ•Ê≠åÊâãÂêçÁß∞" />
                                                </n-form-item>
                                            </n-grid-item>
                                        </n-grid>
                                        <n-form-item label="Ê†áÁ≠æ">
                                            <n-select 
                                                v-model:value="songForm.tags" 
                                                multiple 
                                                :options="tagOptions" 
                                                placeholder="ÈÄâÊã©Ê†áÁ≠æ"
                                                clearable
                                            />
                                        </n-form-item>
                                        <n-form-item>
                                            <n-button type="primary" @click="addSong" :loading="songAdding">Ê∑ªÂä†Ê≠åÊõ≤</n-button>
                                        </n-form-item>
                                    </n-form>
                                </div>

                                <div class="form-section">
                                    <div class="section-title">Ê≠åÊõ≤ÂàóË°®</div>
                                    <n-input v-model:value="songSearchQuery" placeholder="ÊêúÁ¥¢Ê≠åÊõ≤..." style="margin-bottom: 20px;" />
                                    <div v-for="song in filteredSongs" :key="song.id" class="song-item">
                                        <div class="song-info">
                                            <n-text strong>{{ song.title }}</n-text>
                                            <div>{{ song.artist }}</div>
                                            <n-space size="small" style="margin-top: 5px;">
                                                <n-tag v-for="tag in song.tags" :key="tag" size="small">{{ tag }}</n-tag>
                                            </n-space>
                                        </div>
                                        <div class="song-actions">
                                            <n-button size="small" @click="editSong(song)">ÁºñËæë</n-button>
                                            <n-button size="small" type="error" @click="deleteSong(song.id)">Âà†Èô§</n-button>
                                        </div>
                                    </div>
                                    <n-empty v-if="filteredSongs.length === 0" description="ÊöÇÊó†Ê≠åÊõ≤" />
                                </div>
                            </div>
                        </div>

                        <!-- ÁºñËæëÊ†áÁ≠æÊ®°ÊÄÅÊ°Ü -->
                        <n-modal v-model:show="editTagModal.show" preset="dialog" title="ÁºñËæëÊ†áÁ≠æ">
                            <n-input v-model:value="editTagModal.name" placeholder="Ê†áÁ≠æÂêçÁß∞" />
                            <template #action>
                                <n-space>
                                    <n-button @click="editTagModal.show = false">ÂèñÊ∂à</n-button>
                                    <n-button type="primary" @click="updateTag">Á°ÆËÆ§</n-button>
                                </n-space>
                            </template>
                        </n-modal>

                        <!-- ÁºñËæëÊ≠åÊõ≤Ê®°ÊÄÅÊ°Ü -->
                        <n-modal v-model:show="editSongModal.show" preset="dialog" title="ÁºñËæëÊ≠åÊõ≤" style="width: 500px;">
                            <n-form :model="editSongModal.data" label-placement="top">
                                <n-form-item label="Ê≠åÊõ≤ÂêçÁß∞">
                                    <n-input v-model:value="editSongModal.data.title" placeholder="ËØ∑ËæìÂÖ•Ê≠åÊõ≤ÂêçÁß∞" />
                                </n-form-item>
                                <n-form-item label="Ê≠åÊâã">
                                    <n-input v-model:value="editSongModal.data.artist" placeholder="ËØ∑ËæìÂÖ•Ê≠åÊâãÂêçÁß∞" />
                                </n-form-item>
                                <n-form-item label="Ê†áÁ≠æ">
                                    <n-select 
                                        v-model:value="editSongModal.data.tags" 
                                        multiple 
                                        :options="tagOptions" 
                                        placeholder="ÈÄâÊã©Ê†áÁ≠æ"
                                        clearable
                                    />
                                </n-form-item>
                            </n-form>
                            <template #action>
                                <n-space>
                                    <n-button @click="editSongModal.show = false">ÂèñÊ∂à</n-button>
                                    <n-button type="primary" @click="updateSong">Á°ÆËÆ§</n-button>
                                </n-space>
                            </template>
                        </n-modal>
                    </div>
                `,
                setup() {
                    const message = useMessage();
                    return { message };
                },
                components: {
                    NCard,
                    NButton,
                    NIcon,
                    NText,
                    NSpace,
                    NStatistic,
                    NList,
                    NListItem,
                    NThing,
                    NTag,
                    NEmpty,
                    NForm,
                    NFormItem,
                    NInput,
                    NSelect,
                    NGrid,
                    NGridItem,
                    NModal
                },
                
                data() {
                    return {
                        currentPage: 'overview',
                        sidebarOpen: false,
                        loading: false,
                        
                        // Êï∞ÊçÆ
                        songs: [],
                        tags: [],
                        tagDetails: [],
                        
                        // ‰∏ªÊí≠ËÆæÁΩÆÁõ∏ÂÖ≥
                        profileForm: {
                            name: '',
                            description: '',
                            avatar: '',
                            background: ''
                        },
                        profileSaving: false,
                        
                        // Ê†áÁ≠æÁÆ°ÁêÜÁõ∏ÂÖ≥
                        newTagName: '',
                        tagAdding: false,
                        editTagModal: {
                            show: false,
                            id: null,
                            name: ''
                        },
                        
                        // Ê≠åÊõ≤ÁÆ°ÁêÜÁõ∏ÂÖ≥
                        songForm: {
                            title: '',
                            artist: '',
                            tags: []
                        },
                        songAdding: false,
                        songSearchQuery: '',
                        editSongModal: {
                            show: false,
                            data: {
                                id: null,
                                title: '',
                                artist: '',
                                tags: []
                            }
                        },
                        excelImporting: false,
                        imageImporting: false
                    }
                },
                
                computed: {
                    pageTitle() {
                        const titles = {
                            overview: 'Êï∞ÊçÆÊ¶ÇËßà',
                            profile: '‰∏ªÊí≠ËÆæÁΩÆ',
                            tags: 'Ê†áÁ≠æÁÆ°ÁêÜ',
                            songs: 'Ê≠åÊõ≤ÁÆ°ÁêÜ'
                        };
                        return titles[this.currentPage] || 'ÁÆ°ÁêÜÂêéÂè∞';
                    },
                    
                    pageSubtitle() {
                        const subtitles = {
                            overview: 'Êü•ÁúãÊ≠åÂçïÁ≥ªÁªüÁöÑÊï¥‰ΩìÊï∞ÊçÆÁªüËÆ°',
                            profile: 'ÁÆ°ÁêÜ‰∏ªÊí≠Â§¥ÂÉè„ÄÅËÉåÊôØÂíå‰∏™‰∫∫‰ø°ÊÅØ',
                            tags: 'Ê∑ªÂä†„ÄÅÁºñËæëÂíåÂà†Èô§Ê≠åÊõ≤Ê†áÁ≠æ',
                            songs: 'Ê∑ªÂä†ÂíåÁÆ°ÁêÜÊ≠åÂçï‰∏≠ÁöÑÊ≠åÊõ≤'
                        };
                        return subtitles[this.currentPage] || '';
                    },
                    
                    tagOptions() {
                        return this.tags.map(tag => ({
                            label: tag,
                            value: tag
                        }));
                    },
                    
                    filteredSongs() {
                        if (!this.songSearchQuery.trim()) {
                            return this.songs;
                        }
                        const query = this.songSearchQuery.toLowerCase();
                        return this.songs.filter(song => 
                            song.title.toLowerCase().includes(query) ||
                            song.artist.toLowerCase().includes(query)
                        );
                    }
                },
                
                async mounted() {
                    await this.checkAuth();
                    await this.loadInitialData();
                },
                
                methods: {
                    // Ë∫´‰ªΩÈ™åËØÅ
                    async checkAuth() {
                        const token = sessionStorage.getItem('admin_token');
                        if (!token) {
                            this.goToIndex();
                            return;
                        }
                    },
                    
                    goToIndex() {
                        window.location.href = '/';
                    },
                    
                    logout() {
                        sessionStorage.removeItem('admin_token');
                        sessionStorage.removeItem('admin_auth_time');
                        this.message.success('Â∑≤ÈÄÄÂá∫ÁôªÂΩï');
                        setTimeout(() => this.goToIndex(), 1000);
                    },
                    
                    // ÂØºËà™
                    navigateTo(page) {
                        this.currentPage = page;
                        this.sidebarOpen = false;
                    },
                    
                    // Êï∞ÊçÆÂä†ËΩΩ
                    async loadInitialData() {
                        this.loading = true;
                        try {
                            await Promise.all([
                                this.loadTags(),
                                this.loadSongs(),
                                this.loadProfile(),
                                this.loadTagDetails()
                            ]);
                        } catch (error) {
                            this.message.error('Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•: ' + error.message);
                        } finally {
                            this.loading = false;
                        }
                    },
                    
                    async refreshData() {
                        await this.loadInitialData();
                        this.message.success('Êï∞ÊçÆÂ∑≤Âà∑Êñ∞');
                    },
                    
                    async loadTags() {
                        try {
                            const response = await fetch('/api/tags');
                            const data = await response.json();
                            if (data.success) {
                                this.tags = data.data || [];
                            }
                        } catch (error) {
                            console.error('Âä†ËΩΩÊ†áÁ≠æÂ§±Ë¥•:', error);
                        }
                    },
                    
                    async loadTagDetails() {
                        try {
                            const response = await fetch('/api/tags/details');
                            const data = await response.json();
                            if (data.success) {
                                this.tagDetails = data.data || [];
                            }
                        } catch (error) {
                            console.error('Âä†ËΩΩÊ†áÁ≠æËØ¶ÊÉÖÂ§±Ë¥•:', error);
                        }
                    },
                    
                    async loadSongs() {
                        try {
                            // ÂàÜÈ°µÂä†ËΩΩÊâÄÊúâÊ≠åÊõ≤
                            let allSongs = [];
                            let page = 1;
                            let hasMore = true;
                            
                            while (hasMore) {
                                const response = await fetch(`/api/songs?page=${page}&limit=100`);
                                const data = await response.json();
                                
                                if (data.success && data.data.songs) {
                                    allSongs = allSongs.concat(data.data.songs);
                                    
                                    // Ê£ÄÊü•ÊòØÂê¶ËøòÊúâÊõ¥Â§öÊï∞ÊçÆ
                                    const { pagination } = data.data;
                                    hasMore = page < pagination.totalPages;
                                    page++;
                                } else {
                                    hasMore = false;
                                }
                            }
                            
                            this.songs = allSongs;
                        } catch (error) {
                            console.error('Âä†ËΩΩÊ≠åÊõ≤Â§±Ë¥•:', error);
                            this.songs = [];
                        }
                    },
                    
                    async loadProfile() {
                        try {
                            const response = await fetch('/api/streamer/profile');
                            const data = await response.json();
                            if (data.success) {
                                this.profileForm.name = data.data.name || '';
                                this.profileForm.description = data.data.description || '';
                                this.profileForm.avatar = data.data.avatar || '';
                                this.profileForm.background = data.data.background || '';
                            }
                        } catch (error) {
                            console.error('Âä†ËΩΩ‰∏ªÊí≠‰ø°ÊÅØÂ§±Ë¥•:', error);
                        }
                    },
                    
                    // ‰∏ªÊí≠ËÆæÁΩÆÁõ∏ÂÖ≥ÊñπÊ≥ï
                    handleAvatarUpload(event) {
                        const file = event.target.files[0];
                        if (file) {
                            this.uploadAvatar(file);
                        }
                    },
                    
                    handleAvatarDrop(event) {
                        const file = event.dataTransfer.files[0];
                        if (file && file.type.startsWith('image/')) {
                            this.uploadAvatar(file);
                        }
                    },
                    
                    async uploadAvatar(file) {
                        const formData = new FormData();
                        formData.append('avatar', file);
                        
                        try {
                            const response = await fetch('/api/streamer/avatar', {
                                method: 'POST',
                                headers: {
                                    'Authorization': `Bearer ${sessionStorage.getItem('admin_token')}`
                                },
                                body: formData
                            });
                            
                            const data = await response.json();
                            if (data.success) {
                                this.profileForm.avatar = data.avatar_url;
                                this.message.success('Â§¥ÂÉè‰∏ä‰º†ÊàêÂäü');
                            } else {
                                this.message.error(data.error || 'Â§¥ÂÉè‰∏ä‰º†Â§±Ë¥•');
                            }
                        } catch (error) {
                            this.message.error('Â§¥ÂÉè‰∏ä‰º†Â§±Ë¥•: ' + error.message);
                        }
                    },
                    
                    handleBackgroundUpload(event) {
                        const file = event.target.files[0];
                        if (file) {
                            this.uploadBackground(file);
                        }
                    },
                    
                    handleBackgroundDrop(event) {
                        const file = event.dataTransfer.files[0];
                        if (file && file.type.startsWith('image/')) {
                            this.uploadBackground(file);
                        }
                    },
                    
                    async uploadBackground(file) {
                        const formData = new FormData();
                        formData.append('background', file);
                        
                        try {
                            const response = await fetch('/api/streamer/background', {
                                method: 'POST',
                                headers: {
                                    'Authorization': `Bearer ${sessionStorage.getItem('admin_token')}`
                                },
                                body: formData
                            });
                            
                            const data = await response.json();
                            if (data.success) {
                                this.profileForm.background = data.background_url;
                                this.message.success('ËÉåÊôØÂõæ‰∏ä‰º†ÊàêÂäü');
                            } else {
                                this.message.error(data.error || 'ËÉåÊôØÂõæ‰∏ä‰º†Â§±Ë¥•');
                            }
                        } catch (error) {
                            this.message.error('ËÉåÊôØÂõæ‰∏ä‰º†Â§±Ë¥•: ' + error.message);
                        }
                    },
                    
                    async saveProfile() {
                        if (!this.profileForm.name.trim()) {
                            this.message.warning('ËØ∑ËæìÂÖ•‰∏ªÊí≠ÂêçÁß∞');
                            return;
                        }
                        
                        this.profileSaving = true;
                        try {
                            const response = await fetch('/api/streamer/profile', {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': `Bearer ${sessionStorage.getItem('admin_token')}`
                                },
                                body: JSON.stringify({
                                    name: this.profileForm.name,
                                    description: this.profileForm.description
                                })
                            });
                            
                            const data = await response.json();
                            if (data.success) {
                                this.message.success('‰∏ªÊí≠‰ø°ÊÅØ‰øùÂ≠òÊàêÂäü');
                            } else {
                                this.message.error(data.error || '‰øùÂ≠òÂ§±Ë¥•');
                            }
                        } catch (error) {
                            this.message.error('‰øùÂ≠òÂ§±Ë¥•: ' + error.message);
                        } finally {
                            this.profileSaving = false;
                        }
                    },
                    
                    // Ê†áÁ≠æÁÆ°ÁêÜÁõ∏ÂÖ≥ÊñπÊ≥ï
                    async addTag() {
                        if (!this.newTagName.trim()) {
                            this.message.warning('ËØ∑ËæìÂÖ•Ê†áÁ≠æÂêçÁß∞');
                            return;
                        }
                        
                        this.tagAdding = true;
                        try {
                            const response = await fetch('/api/tags', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': `Bearer ${sessionStorage.getItem('admin_token')}`
                                },
                                body: JSON.stringify({ name: this.newTagName })
                            });
                            
                            const data = await response.json();
                            if (data.success) {
                                this.newTagName = '';
                                this.message.success('Ê†áÁ≠æÊ∑ªÂä†ÊàêÂäü');
                                await this.loadTags();
                                await this.loadTagDetails();
                            } else {
                                this.message.error(data.error || 'Ê∑ªÂä†Â§±Ë¥•');
                            }
                        } catch (error) {
                            this.message.error('Ê∑ªÂä†Â§±Ë¥•: ' + error.message);
                        } finally {
                            this.tagAdding = false;
                        }
                    },
                    
                    editTag(tag) {
                        this.editTagModal.show = true;
                        this.editTagModal.id = tag.id;
                        this.editTagModal.name = tag.name;
                    },
                    
                    async updateTag() {
                        if (!this.editTagModal.name.trim()) {
                            this.message.warning('ËØ∑ËæìÂÖ•Ê†áÁ≠æÂêçÁß∞');
                            return;
                        }
                        
                        try {
                            const response = await fetch(`/api/tags/${this.editTagModal.id}`, {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': `Bearer ${sessionStorage.getItem('admin_token')}`
                                },
                                body: JSON.stringify({ name: this.editTagModal.name })
                            });
                            
                            const data = await response.json();
                            if (data.success) {
                                this.editTagModal.show = false;
                                this.message.success('Ê†áÁ≠æÊõ¥Êñ∞ÊàêÂäü');
                                await this.loadTags();
                                await this.loadTagDetails();
                            } else {
                                this.message.error(data.error || 'Êõ¥Êñ∞Â§±Ë¥•');
                            }
                        } catch (error) {
                            this.message.error('Êõ¥Êñ∞Â§±Ë¥•: ' + error.message);
                        }
                    },
                    
                    async deleteTag(tagName) {
                        try {
                            const response = await fetch(`/api/tags/${encodeURIComponent(tagName)}`, {
                                method: 'DELETE',
                                headers: {
                                    'Authorization': `Bearer ${sessionStorage.getItem('admin_token')}`
                                }
                            });
                            
                            const data = await response.json();
                            if (data.success) {
                                this.message.success('Ê†áÁ≠æÂà†Èô§ÊàêÂäü');
                                await this.loadTags();
                                await this.loadTagDetails();
                            } else {
                                this.message.error(data.error || 'Âà†Èô§Â§±Ë¥•');
                            }
                        } catch (error) {
                            this.message.error('Âà†Èô§Â§±Ë¥•: ' + error.message);
                        }
                    },
                    
                    // Ê≠åÊõ≤ÁÆ°ÁêÜÁõ∏ÂÖ≥ÊñπÊ≥ï
                    async addSong() {
                        if (!this.songForm.title.trim() || !this.songForm.artist.trim()) {
                            this.message.warning('ËØ∑Â°´ÂÜôÊ≠åÊõ≤ÂêçÁß∞ÂíåÊ≠åÊâã');
                            return;
                        }
                        
                        this.songAdding = true;
                        try {
                            const response = await fetch('/api/songs', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': `Bearer ${sessionStorage.getItem('admin_token')}`
                                },
                                body: JSON.stringify({
                                    title: this.songForm.title,
                                    artist: this.songForm.artist,
                                    tags: this.songForm.tags
                                })
                            });
                            
                            const data = await response.json();
                            if (data.success) {
                                this.songForm = { title: '', artist: '', tags: [] };
                                this.message.success('Ê≠åÊõ≤Ê∑ªÂä†ÊàêÂäü');
                                await this.loadSongs();
                            } else {
                                this.message.error(data.error || 'Ê∑ªÂä†Â§±Ë¥•');
                            }
                        } catch (error) {
                            this.message.error('Ê∑ªÂä†Â§±Ë¥•: ' + error.message);
                        } finally {
                            this.songAdding = false;
                        }
                    },
                    
                    editSong(song) {
                        this.editSongModal.show = true;
                        this.editSongModal.data = {
                            id: song.id,
                            title: song.title,
                            artist: song.artist,
                            tags: [...(song.tags || [])]
                        };
                    },
                    
                    async updateSong() {
                        if (!this.editSongModal.data.title.trim() || !this.editSongModal.data.artist.trim()) {
                            this.message.warning('ËØ∑Â°´ÂÜôÊ≠åÊõ≤ÂêçÁß∞ÂíåÊ≠åÊâã');
                            return;
                        }
                        
                        try {
                            const response = await fetch(`/api/songs/${this.editSongModal.data.id}`, {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json',
                                    'Authorization': `Bearer ${sessionStorage.getItem('admin_token')}`
                                },
                                body: JSON.stringify({
                                    title: this.editSongModal.data.title,
                                    artist: this.editSongModal.data.artist,
                                    tags: this.editSongModal.data.tags
                                })
                            });
                            
                            const data = await response.json();
                            if (data.success) {
                                this.editSongModal.show = false;
                                this.message.success('Ê≠åÊõ≤Êõ¥Êñ∞ÊàêÂäü');
                                await this.loadSongs();
                            } else {
                                this.message.error(data.error || 'Êõ¥Êñ∞Â§±Ë¥•');
                            }
                        } catch (error) {
                            this.message.error('Êõ¥Êñ∞Â§±Ë¥•: ' + error.message);
                        }
                    },
                    
                    async deleteSong(songId) {
                        try {
                            const response = await fetch(`/api/songs/${songId}`, {
                                method: 'DELETE',
                                headers: {
                                    'Authorization': `Bearer ${sessionStorage.getItem('admin_token')}`
                                }
                            });
                            
                            const data = await response.json();
                            if (data.success) {
                                this.message.success('Ê≠åÊõ≤Âà†Èô§ÊàêÂäü');
                                await this.loadSongs();
                            } else {
                                this.message.error(data.error || 'Âà†Èô§Â§±Ë¥•');
                            }
                        } catch (error) {
                            this.message.error('Âà†Èô§Â§±Ë¥•: ' + error.message);
                        }
                    },

                    // ÊâπÈáèÂØºÂÖ•ÊñπÊ≥ï
                    async handleExcelImport(event) {
                        const file = event.target.files[0];
                        if (!file) return;

                        this.excelImporting = true;
                        try {
                            const formData = new FormData();
                            formData.append('file', file);
                            const response = await fetch('/api/songs/import/excel', {
                                method: 'POST',
                                headers: {
                                    'Authorization': `Bearer ${sessionStorage.getItem('admin_token')}`
                                },
                                body: formData
                            });
                            const data = await response.json();
                            if (data.success) {
                                this.message.success('Ê≠åÊõ≤ÊâπÈáèÂØºÂÖ•ÊàêÂäüÔºÅ');
                                await this.loadSongs();
                            } else {
                                this.message.error(data.error || 'Ê≠åÊõ≤ÊâπÈáèÂØºÂÖ•Â§±Ë¥•');
                            }
                        } catch (error) {
                            this.message.error('Ê≠åÊõ≤ÊâπÈáèÂØºÂÖ•Â§±Ë¥•: ' + error.message);
                        } finally {
                            this.excelImporting = false;
                        }
                    },

                    async handleImageImport(event) {
                        const file = event.target.files[0];
                        if (!file) return;

                        this.imageImporting = true;
                        try {
                            const formData = new FormData();
                            formData.append('file', file);
                            const response = await fetch('/api/songs/import/image', {
                                method: 'POST',
                                headers: {
                                    'Authorization': `Bearer ${sessionStorage.getItem('admin_token')}`
                                },
                                body: formData
                            });
                            const data = await response.json();
                            if (data.success) {
                                this.message.success('Ê≠åÊõ≤ÊâπÈáèÂØºÂÖ•ÊàêÂäüÔºÅ');
                                await this.loadSongs();
                            } else {
                                this.message.error(data.error || 'Ê≠åÊõ≤ÊâπÈáèÂØºÂÖ•Â§±Ë¥•');
                            }
                        } catch (error) {
                            this.message.error('Ê≠åÊõ≤ÊâπÈáèÂØºÂÖ•Â§±Ë¥•: ' + error.message);
                        } finally {
                            this.imageImporting = false;
                        }
                    }
                }
            };

            createApp({
                components: {
                    NConfigProvider,
                    NMessageProvider,
                    AdminContent
                },
                data() {
                    return {
                        theme: null,
                        themeOverrides: {
                            common: {
                                primaryColor: '#667eea',
                                primaryColorHover: '#5a6fd8',
                                primaryColorPressed: '#4d60c4'
                            }
                        }
                    }
                }
            }).mount('#app');
        }
    </script>
</body>
</html>